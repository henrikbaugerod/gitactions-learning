name: Deploy React App

on:
  push:
    branches:
      - main   # or your branch name

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, 
      # so your job can access it
    - name: Checkout code
      uses: actions/checkout@v4
      with:
          # Fetch all history for all tags and branches
          fetch-depth: 0

          # Checkout a specific branch
          ref: main

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20' # or your node version

    - name: Install dependencies
      run: npm install

    - name: Build the project
      run: npm run build

    - name: Upload via SFTP
      uses: milanmk/actions-file-deployer@master
      with:
          remote-protocol: sftp

          # Credentials for SFTP access to server using GitHub secrets
          remote-host: ${{ secrets.SFTP_HOST }}
          remote-user: ${{ secrets.SFTP_USER }}
          remote-password: ${{ secrets.SFTP_PASS }}

          # Path for specific folder on server for files deployment
          remote-path: /home/u332075499/domains/henrikbaugerod.no/public_html/test/

          # Port for SFTP access to server
          remote-port: 21
